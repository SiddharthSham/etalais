!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@smoovy/utils")):"function"==typeof define&&define.amd?define(["exports","@smoovy/utils"],e):e((t=t||self).smoovyObserver={},t.smoovyUtils)}(this,function(t,e){"use strict";class s{constructor(t){this.size={width:0,height:0},this.offset={x:0,y:0},this._destroyed=!1,this.changeListeners=[],this.destroyListeners=[],this.lastSum=0,this.element=t instanceof s?t.element:t}update(t=!1,e=!1){t?setTimeout(()=>this.updateDimensions(e)):this.updateDimensions(e)}onDestroy(t){this.destroyListeners.push(t)}updateDimensions(t){this.updateSize(),this.updateOffset(),(this.hasChanged()||t)&&this.emitChanges()}emitChanges(){for(let t=0,e=this.changeListeners.length;t<e;t++)this.changeListeners[t].call(this,this.size,this.offset)}removeListener(t){this.changeListeners=this.changeListeners.filter(e=>e!==t)}destroy(){this._destroyed=!0;for(let t=0,e=this.destroyListeners.length;t<e;t++)this.destroyListeners[t].call(this);this.changeListeners=[],this.destroyListeners=[]}get destroyed(){return this._destroyed}changed(t,s=0){return s>0&&(t=e.throttle(t,s)),this.changeListeners.push(t),{remove:()=>this.removeListener(t)}}updateSize(){if(e.Browser.client){const t=this.element.getBoundingClientRect();this.size.width=t.width,this.size.height=t.height}else this.size.width=0,this.size.height=0}updateOffset(){if(e.Browser.client){const t=e.getElementOffset(this.element);this.offset.x=t.x,this.offset.y=t.y}else this.offset.x=0,this.offset.y=0}hasChanged(){const t=this.offset.x+this.offset.y+this.size.width+this.size.height,e=t!==this.lastSum;return this.lastSum=t,e}inViewport(t,e,s={x:0,y:0}){const i=Object.assign({},this.offset),h={above:i.y+s.y+this.size.height<t.y,below:i.y-s.y>t.y+e.height,left:i.x+s.x+this.size.width<t.x,right:i.x-s.x>t.x+e.width};return Object.assign(Object.assign({},h),{inside:!(h.above||h.below||h.right||h.left)})}}class i{static changed(t,s=0){return s>0&&(t=e.throttle(t,s)),this.listeners.push(t),this.checkListeners(),{remove:()=>this.removeListener(t)}}static removeListener(t){const e=this.listeners.indexOf(t);e>-1&&(this.listeners.splice(e,1),this.checkListeners())}static checkListeners(){this.listening=this.listeners.length>0}static set listening(t){t&&!this._listening?this.attach():!t&&this._listening&&this.detach(),this._listening=t}static get attached(){return this._listening}static get state(){return this.stateResolver.promise}static update(t=!1,s=!1){e.Browser.client&&(this._state.width=window.innerWidth,this._state.height=window.innerHeight),this.stateResolver.completed||this.stateResolver.resolve(this._state),s||this.handleResize(t)}static getStateSum(){return this._state.width+this._state.height}static handleResize(t=!1){cancelAnimationFrame(this.lastRafId);const e=this.getStateSum();this.lastRafId=requestAnimationFrame(()=>{if(this.update(),e!==this.getStateSum()||!0===t)for(let t=0,e=this.listeners.length;t<e;t++)this.listeners[t].call(this,this._state)})}static attach(){this.resizeListener||(this.handleResize(),this.resizeListener=(()=>this.handleResize()),e.Browser.client&&window.addEventListener("resize",this.resizeListener,!0))}static detach(){this.resizeListener&&(e.Browser.client&&window.removeEventListener("resize",this.resizeListener,!0),this.resizeListener=void 0)}}i._listening=!1,i._state={width:0,height:0},i.lastRafId=-1,i.listeners=[],i.stateResolver=new e.Resolver;const h={mutationThrottle:100,viewportThrottle:100,mutators:[{target:e.Browser.client?document.documentElement:void 0,options:{characterData:!0,childList:!0,subtree:!0}}]};class r{constructor(t={}){this.config=t,this.attached=!1,this.states=[]}static observe(t){return this.default.observe(t)}static reset(){return this.default.reset()}observe(t){for(let e=0,s=this.states.length;e<s;e++)if(this.states[e]===t||this.states[e].element===t)return this.states[e];return this.register(t instanceof s?t:new s(t))}register(t){return this.states.push(t),this.checkStates(),t.update(!0),t.onDestroy(()=>this.deregister(t)),t}deregister(t){const e=this.states.indexOf(t);e>-1&&(this.states.splice(e,1),this.checkStates())}reset(){this.states.forEach(t=>this.deregister(t))}updateRaf(){e.Browser.client?(cancelAnimationFrame(this.lastRaf),this.lastRaf=requestAnimationFrame(()=>this.update())):this.update()}update(t=!1){for(let e=0,s=this.states.length;e<s;e++)this.states[e].update(t)}attach(){if(this.attached=!0,this.viewportObserver=i.changed("number"==typeof this.config.viewportThrottle?e.throttle(()=>this.update(),this.config.viewportThrottle):()=>this.update()),e.Browser.client&&e.Browser.mutationObserver&&this.config.mutators){const t=this.config.mutationThrottle;this.mutationObserver=new MutationObserver("number"==typeof t?e.throttle(()=>this.updateRaf(),t):()=>this.updateRaf()),this.config.mutators.forEach(t=>{t.target&&this.mutationObserver&&this.mutationObserver.observe(t.target,Object.assign({},t.options))})}let t;e.Browser.client&&document.addEventListener("DOMContentLoaded",t=(()=>{this.updateRaf(),document.removeEventListener("DOMContentLoaded",t)}),!1),this.updateRaf()}detach(){this.attached=!1,this.viewportObserver&&(this.viewportObserver.remove(),this.viewportObserver=void 0),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=void 0)}checkStates(){this.states.length>0&&!this.attached&&this.attach(),0===this.states.length&&this.attached&&this.detach()}}r.default=new r(h),t.ElementObserver=r,t.ElementState=s,t.ViewportObserver=i,t.elementObserverDefaultConfig=h,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
