{"version":3,"file":"index.js","sources":["../../src/emitter.ts","../../src/element.ts","../../src/utils.ts"],"sourcesContent":["import { Unlisten } from './utils';\n\nexport type EventListenerCb<T = any> = (data: T) => void;\nexport type ListenerCallback<T = any> = (...args: T[]) => void;\n\nexport class EventEmitter {\n  private listeners: { [name: string]: EventListenerCb[] } = {};\n  private emitters: EventEmitter[] = [];\n  private mutedEvents: string[] = [];\n\n  public emit<T = any, TC = T>(\n    eventsOrName: { [name: string]: T } | string,\n    dataOrCallback?: T | ListenerCallback<TC>,\n    callback: ListenerCallback<TC> = () => {}\n  ) {\n    const listenerCb = typeof dataOrCallback === 'function'\n      ? dataOrCallback as ListenerCallback<TC>\n      : callback;\n\n    if (typeof eventsOrName === 'string') {\n      const name = eventsOrName;\n\n      if ( ! this.isEventMuted(name)) {\n        for (let i = 0, len = this.emitters.length; i < len; i++) {\n          this.emitters[i].emit(eventsOrName, dataOrCallback, callback);\n        }\n\n        /* istanbul ignore else */\n        if (this.listeners.hasOwnProperty(name)) {\n          for (let i = 0, len = this.listeners[name].length; i < len; i++) {\n            listenerCb.call(\n              this,\n              this.listeners[name][i].call(\n                this,\n                dataOrCallback !== listenerCb\n                  ? dataOrCallback as T\n                  : undefined\n              ) as any\n            );\n          }\n        }\n      }\n    } else {\n      const events = eventsOrName;\n      const keys = Object.keys(events);\n\n      for (let k = 0, lenK = keys.length; k < lenK; k++) {\n        const name = keys[k];\n        const eventData = events[name];\n\n        /* istanbul ignore else */\n        if ( ! this.isEventMuted(name)) {\n          for (let i = 0, len = this.emitters.length; i < len; i++) {\n            this.emitters[i].emit(name, eventData, callback);\n          }\n\n          /* istanbul ignore else */\n          if (this.listeners.hasOwnProperty(name)) {\n            for (let i = 0, len = this.listeners[name].length; i < len; i++) {\n              listenerCb.call(\n                this,\n                this.listeners[name][i].call(this, eventData) as any\n              );\n            }\n          }\n        }\n      }\n    }\n\n    return this;\n  }\n\n  public on<T>(name: string, cb: EventListenerCb<T>): Unlisten {\n    if (this.listeners.hasOwnProperty(name)) {\n      this.listeners[name].push(cb);\n    } else {\n      this.listeners[name] = [ cb ];\n    }\n\n    return () => this.off(name, cb);\n  }\n\n  public off(name: string, cb: EventListenerCb) {\n    const listeners = this.listeners;\n\n    /* istanbul ignore else */\n    if (listeners.hasOwnProperty(name)) {\n      const index = listeners[name].indexOf(cb);\n\n      /* istanbul ignore else */\n      if (index > -1) {\n        listeners[name].splice(index, 1);\n      }\n    }\n  }\n\n  public hasEventListeners(name: string) {\n    return this.listeners[name] && this.listeners[name].length > 0;\n  }\n\n  public isEventMuted(event: string) {\n    return this.mutedEvents.includes(event);\n  }\n\n  public muteEvents(...events: (string|boolean)[]): Unlisten {\n    events.forEach(event => {\n      /* istanbul ignore else */\n      if (typeof event === 'string' && ! this.mutedEvents.includes(event)) {\n        this.mutedEvents.push(event);\n      }\n    });\n\n    return () => this.unmuteEvents(...events);\n  }\n\n  public unmuteEvents(...events: (string|boolean)[]) {\n    events.forEach(event => {\n      /* istanbul ignore else */\n      if (typeof event === 'string') {\n        const index = this.mutedEvents.indexOf(event);\n\n        /* istanbul ignore else */\n        if (index > -1) {\n          this.mutedEvents.splice(index, 1);\n        }\n      }\n    });\n  }\n\n  public reflectEvents(...emitters: EventEmitter[]) {\n    this.emitters = emitters;\n  }\n\n  public unreflectEvents() {\n    this.emitters = [];\n  }\n}\n","import { Unlisten } from './utils';\n\nexport function listenEl(\n  element: HTMLElement | Document | Window,\n  type: string | string[],\n  listener: (event: any) => any,\n  options?: boolean | AddEventListenerOptions\n): Unlisten {\n  /* istanbul ignore else */\n  if (typeof type === 'string') {\n    type = [ type ];\n  }\n\n  type.forEach(t => element.addEventListener(t, listener, options));\n\n  return () => (type as string[]).forEach(t => {\n    element.removeEventListener(t, listener, options);\n  });\n}\n","export type Unlisten = () => void;\n\nexport function listenCompose<T extends Unlisten | undefined>(\n  ...listeners: T[]\n): Unlisten {\n  return () => listeners.forEach(cb => (\n    typeof cb === 'function' && cb.call(undefined)\n  ));\n}\n"],"names":["EventEmitter","[object Object]","this","eventsOrName","dataOrCallback","callback","listenerCb","name","isEventMuted","i","len","emitters","length","emit","listeners","hasOwnProperty","call","undefined","events","keys","Object","k","lenK","eventData","cb","push","off","index","indexOf","splice","event","mutedEvents","includes","forEach","unmuteEvents","listenEl","element","type","listener","options","t","addEventListener","removeEventListener","listenCompose"],"mappings":"0EAKaA,aAAbC,cACUC,eAAmD,GACnDA,cAA2B,GAC3BA,iBAAwB,GAEzBD,KACLE,EACAC,EACAC,EAAiC,UAEjC,MAAMC,EAAuC,mBAAnBF,EACtBA,EACAC,EAEJ,GAA4B,iBAAjBF,EAA2B,CACpC,MAAMI,EAAOJ,EAEb,IAAOD,KAAKM,aAAaD,GAAO,CAC9B,IAAK,IAAIE,EAAI,EAAGC,EAAMR,KAAKS,SAASC,OAAQH,EAAIC,EAAKD,IACnDP,KAAKS,SAASF,GAAGI,KAAKV,EAAcC,EAAgBC,GAItD,GAAIH,KAAKY,UAAUC,eAAeR,GAChC,IAAK,IAAIE,EAAI,EAAGC,EAAMR,KAAKY,UAAUP,GAAMK,OAAQH,EAAIC,EAAKD,IAC1DH,EAAWU,KACTd,KACAA,KAAKY,UAAUP,GAAME,GAAGO,KACtBd,KACAE,IAAmBE,EACfF,OACAa,SAMT,CACL,MAAMC,EAASf,EACTgB,EAAOC,OAAOD,KAAKD,GAEzB,IAAK,IAAIG,EAAI,EAAGC,EAAOH,EAAKP,OAAQS,EAAIC,EAAMD,IAAK,CACjD,MAAMd,EAAOY,EAAKE,GACZE,EAAYL,EAAOX,GAGzB,IAAOL,KAAKM,aAAaD,GAAO,CAC9B,IAAK,IAAIE,EAAI,EAAGC,EAAMR,KAAKS,SAASC,OAAQH,EAAIC,EAAKD,IACnDP,KAAKS,SAASF,GAAGI,KAAKN,EAAMgB,EAAWlB,GAIzC,GAAIH,KAAKY,UAAUC,eAAeR,GAChC,IAAK,IAAIE,EAAI,EAAGC,EAAMR,KAAKY,UAAUP,GAAMK,OAAQH,EAAIC,EAAKD,IAC1DH,EAAWU,KACTd,KACAA,KAAKY,UAAUP,GAAME,GAAGO,KAAKd,KAAMqB,MAQ/C,OAAOrB,KAGFD,GAAMM,EAAciB,GAOzB,OANItB,KAAKY,UAAUC,eAAeR,GAChCL,KAAKY,UAAUP,GAAMkB,KAAKD,GAE1BtB,KAAKY,UAAUP,GAAQ,CAAEiB,GAGpB,IAAMtB,KAAKwB,IAAInB,EAAMiB,GAGvBvB,IAAIM,EAAciB,GACvB,MAAMV,EAAYZ,KAAKY,UAGvB,GAAIA,EAAUC,eAAeR,GAAO,CAClC,MAAMoB,EAAQb,EAAUP,GAAMqB,QAAQJ,GAGlCG,GAAS,GACXb,EAAUP,GAAMsB,OAAOF,EAAO,IAK7B1B,kBAAkBM,GACvB,OAAOL,KAAKY,UAAUP,IAASL,KAAKY,UAAUP,GAAMK,OAAS,EAGxDX,aAAa6B,GAClB,OAAO5B,KAAK6B,YAAYC,SAASF,GAG5B7B,cAAciB,GAQnB,OAPAA,EAAOe,QAAQH,IAEQ,iBAAVA,GAAwB5B,KAAK6B,YAAYC,SAASF,IAC3D5B,KAAK6B,YAAYN,KAAKK,KAInB,IAAM5B,KAAKgC,gBAAgBhB,GAG7BjB,gBAAgBiB,GACrBA,EAAOe,QAAQH,IAEb,GAAqB,iBAAVA,EAAoB,CAC7B,MAAMH,EAAQzB,KAAK6B,YAAYH,QAAQE,GAGnCH,GAAS,GACXzB,KAAK6B,YAAYF,OAAOF,EAAO,MAMhC1B,iBAAiBU,GACtBT,KAAKS,SAAWA,EAGXV,kBACLC,KAAKS,SAAW,aCpIJwB,SACdC,EACAC,EACAC,EACAC,GASA,MANoB,iBAATF,IACTA,EAAO,CAAEA,IAGXA,EAAKJ,QAAQO,GAAKJ,EAAQK,iBAAiBD,EAAGF,EAAUC,IAEjD,IAAOF,EAAkBJ,QAAQO,IACtCJ,EAAQM,oBAAoBF,EAAGF,EAAUC,cCd7BI,iBACX7B,GAEH,MAAO,IAAMA,EAAUmB,QAAQT,GACf,mBAAPA,GAAqBA,EAAGR,UAAKC"}