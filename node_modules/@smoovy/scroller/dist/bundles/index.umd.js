!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@smoovy/utils"),require("@smoovy/event"),require("@smoovy/ticker"),require("@smoovy/observer"),require("@smoovy/tween")):"function"==typeof define&&define.amd?define(["exports","@smoovy/utils","@smoovy/event","@smoovy/ticker","@smoovy/observer","@smoovy/tween"],t):t((e=e||self).smoovyScroller={},e.smoovyUtils,e.smoovyEvent,e.smoovyTicker,e.smoovyObserver,e.smoovyTween)}(this,function(e,t,o,i,s,r){"use strict";(e.ScrollerDomEvent||(e.ScrollerDomEvent={})).RECALC="recalc";class n extends o.EventEmitter{constructor(t){super(),this.config=t,this.dynamic=!1,this.dynamic=t.element instanceof HTMLElement,!1!==t.observer&&(this.observer=new s.ElementObserver(t.observer)),this.container=new s.ElementState(this.dynamic?document.createElement("div"):t.element.container),this.wrapper=new s.ElementState(this.dynamic?document.createElement("div"):t.element.wrapper),this.observer&&(this.container=this.observer.observe(this.container),this.wrapper=this.observer.observe(this.wrapper),this.wrapper.changed(()=>this.emit(e.ScrollerDomEvent.RECALC)),this.container.changed(()=>this.emit(e.ScrollerDomEvent.RECALC))),this.dynamic&&(this.container.element.className+="smoovy-container",this.wrapper.element.className+="smoovy-wrapper",this.container.element.appendChild(this.wrapper.element))}recalc(e=!1){this.wrapper.update(e),this.container.update(e)}attach(){if(this.dynamic){const e=this.config.element,t=Array.from(e.childNodes);e.appendChild(this.container.element),this.wrapper.element.append(...t)}}detach(){if(this.dynamic){const e=this.config.element,t=Array.from(this.wrapper.element.childNodes);e.append(...t),e.removeChild(this.container.element)}}}var l;(l=e.ScrollerEvent||(e.ScrollerEvent={})).DELTA="delta",l.OUTPUT="output",l.VIRTUAL="virtual",l.RECALC="recalc",l.TWEEN_TO="tween_to",l.SCROLL_TO="scroll_to",l.TRANSFORM_DELTA="~delta",l.TRANSFORM_VIRTUAL="~virtual",l.TRANSFORM_OUTPUT="~output";class a extends o.EventEmitter{constructor(e,t){super(),this.attached=!1,this.locks=[],this.availableBehaviors=new Map,this.attachedBehaviors=new Map,this.position={output:{x:0,y:0},virtual:{x:0,y:0}},this.dom=e instanceof n?e:new n(e instanceof HTMLElement?{element:e}:e);for(const e in t)t.hasOwnProperty(e)&&this.setBehavior(e,t[e]);this.attach()}attach(){this.attached||(this.attached=!0,this.unlisten=o.listenCompose(this.dom.on(e.ScrollerDomEvent.RECALC,()=>{this.updateDelta({x:0,y:0}),i.Ticker.requestAnimationFrame(()=>this.emit(e.ScrollerEvent.RECALC))}),this.on(e.ScrollerEvent.DELTA,e=>{this.isLocked()||this.updateDelta(e)})),this.dom.attach(),this.availableBehaviors.forEach((e,t)=>{this.attachBehavior(t)}))}destroy(){this.attached&&(this.attached=!1,"function"==typeof this.unlisten&&(this.unlisten(),delete this.unlisten),this.dom.detach(),this.attachedBehaviors.forEach(e=>{"function"==typeof e&&e.call(this)}))}recalc(t=!1){this.dom.recalc(t),t?i.Ticker.requestAnimationFrame(()=>this.emit(e.ScrollerEvent.RECALC)):this.emit(e.ScrollerEvent.RECALC)}get behaviors(){return this.availableBehaviors}setBehavior(e,t){this.availableBehaviors.set(e,t)}deleteBehavior(e){return this.attachedBehaviors.has(e)&&this.detachBehavior(e),this.availableBehaviors.delete(e)}attachBehavior(e){const t=this.availableBehaviors.get(e);return!(!t||this.attachedBehaviors.get(e)||(this.attachedBehaviors.set(e,t(this)),0))}detachBehavior(e){const t=this.attachedBehaviors.get(e);return!!t&&(t.call(this),this.attachedBehaviors.delete(e),!0)}updateDelta(o){const i=this.position.virtual;this.emit(e.ScrollerEvent.TRANSFORM_DELTA,o,e=>{o.x=e.x,o.y=e.y}),this.updatePosition({x:t.isNum(o.x)?i.x-o.x:void 0,y:t.isNum(o.y)?i.y-o.y:void 0})}updatePosition(o){o&&t.isNum(o.x)&&(this.position.virtual.x=o.x),o&&t.isNum(o.y)&&(this.position.virtual.y=o.y),this.emit(e.ScrollerEvent.VIRTUAL,this.position.virtual),this.emit(e.ScrollerEvent.TRANSFORM_VIRTUAL,this.position.virtual,e=>{this.position.virtual.x=e.x,this.position.virtual.y=e.y}),this.isEventMuted(e.ScrollerEvent.TRANSFORM_OUTPUT)||!this.hasEventListeners(e.ScrollerEvent.TRANSFORM_OUTPUT)?this.updateOutput(this.position.virtual):this.emit(e.ScrollerEvent.TRANSFORM_OUTPUT,{pos:this.position.output,step:e=>this.updateOutput(e)})}updateOutput(t){this.position.output.x=t.x,this.position.output.y=t.y,this.emit(e.ScrollerEvent.OUTPUT,t)}lock(e="default",t=!0){!this.locks.includes(e)&&t?this.locks.push(e):t||this.unlock(e)}unlock(e="default"){const t=this.locks.indexOf(e);t>-1&&this.locks.splice(t,1)}isLocked(e){return e?this.locks.includes(e):this.locks.length>0}scrollTo(t,o=!1){this.emit(e.ScrollerEvent.SCROLL_TO,{pos:t,skipOutputTransform:o})}tweenTo(t,o={}){this.emit(e.ScrollerEvent.TWEEN_TO,{pos:t,options:o})}onVirtual(t){return this.on(e.ScrollerEvent.VIRTUAL,t)}onScroll(t){return this.on(e.ScrollerEvent.OUTPUT,t)}onDelta(t){return this.on(e.ScrollerEvent.DELTA,t)}}const c=(s={})=>r=>{const n=s.focusTarget||t.Browser.client?window:void 0,l=r.dom.container.element,a=s.ignoreInside||[];return o.listenCompose(o.listenEl(l,"scroll",e=>{e.preventDefault(),l.scrollLeft=l.scrollTop=0}),n?o.listenEl(n,"focus",t=>{i.Ticker.requestAnimationFrame(()=>{const o=t.target;if(o instanceof HTMLElement&&(!a.map(e=>e.contains(o)).includes(!0)&&o&&l.contains(o)||l===o)){const t=o.getBoundingClientRect(),i=r.dom.container.size;if(t.top<=0||t.top>=i.height||t.left<=0||t.right>=i.width)if(s.nativeTarget){const e=r.position.virtual;s.nativeTarget.scrollTo(e.x+t.left-i.width/2,e.y+t.top-i.height/2)}else r.emit(e.ScrollerEvent.DELTA,{y:-t.top+i.height/2,x:-t.left+i.width/2})}})},!0):void 0)};function h(e,t=100,o=250,i=200,s=1/0){const r={x:0,y:0};switch(e.key){case" ":r.y=-i;break;case"ArrowLeft":r.x=t;break;case"ArrowRight":r.x=-t;break;case"ArrowDown":r.y=-t;break;case"ArrowUp":r.y=t;break;case"PageDown":r.y=-o;break;case"PageUp":r.y=o;break;case"Home":r.y=s;break;case"End":r.y=-s}return r}const p={condition:()=>!1},v=(s={})=>{const n=Object.assign(p,s);let l;return l=(s=>{const a=n.target||window,c=[];let p;const v=()=>({x:a===window?a.scrollX:a.scrollLeft,y:a===window?a.scrollY:a.scrollTop}),u=()=>{n.condition()?(s.behaviors.forEach((e,t)=>{e!==l&&(s.detachBehavior(t),c.push(t))}),p=o.listenCompose(o.listenEl(a,"scroll",()=>{const t=v();s.emit(e.ScrollerEvent.DELTA,{x:s.position.virtual.x-t.x,y:s.position.virtual.y-t.y})}),s.on(e.ScrollerEvent.SCROLL_TO,({pos:e})=>{if(t.isNum(e.x)||t.isNum(e.y)){const o=v();a.scrollTo(t.isNum(e.x)?e.x:o.x,t.isNum(e.y)?e.y:o.y)}})),s.on(e.ScrollerEvent.TWEEN_TO,({pos:e,options:t})=>{const i=!!t.force;let n;const l=()=>{n&&!i&&(n.stop(),n=void 0)},a=o.listenCompose(o.listenEl(window,"touchstart",l),o.listenEl(window,"wheel",l),o.listenEl(window,"keydown",e=>{const t=h(e);"Tab"!==e.key&&0===t.x&&0===t.y||l()}));n=r.Tween.fromTo(s.position.virtual,e,{mutate:!1,duration:t.duration,easing:t.easing,on:{update:e=>window.scrollTo(e.x,e.y),complete:a,stop:a}})})):c.length>0&&(p&&(p(),p=void 0),c.forEach(e=>s.attachBehavior(e)),i.Ticker.requestAnimationFrame(()=>s.dom.recalc()))};setTimeout(()=>u()),s.on(e.ScrollerEvent.RECALC,()=>u())})},u=()=>o=>o.on(e.ScrollerEvent.TRANSFORM_VIRTUAL,e=>{const i=o.dom.wrapper.size,s=o.dom.container.size,r=Math.max(i.width-s.width,0),n=Math.max(i.height-s.height,0);return{x:t.clamp(e.x,0,r),y:t.clamp(e.y,0,n)}}),m={passive:!1,target:t.Browser.client?document.documentElement:void 0,eventName:"keydown",arrowDelta:100,pageDelta:250,spaceDelta:200,homeEndDelta:1/0},d=(i={})=>{const s=Object.assign(m,i);return r=>{const n=s.target;return t.Browser.wheelEvent?o.listenEl(n,s.eventName,t=>{const o=h(t,s.arrowDelta,s.pageDelta,s.spaceDelta,s.homeEndDelta);(o.x||o.y)&&r.emit(e.ScrollerEvent.DELTA,o)},{passive:i.passive}):void 0}},y={damping:.1,precision:.009,mobileDamping:.18},T=(o={})=>{const s=Object.assign(y,o);return o=>{let r;const n=s.ticker||new i.Ticker,l=t.Browser.mobile?s.mobileDamping:s.damping,a=o.on(e.ScrollerEvent.TRANSFORM_OUTPUT,({pos:e,step:i})=>{r&&r.kill(),r=n.add((r,n,a)=>{const c=o.position.virtual,h=t.lerp(e.x,c.x,l),p=t.lerp(e.y,c.y,l),v=Math.abs(c.x-h),u=Math.abs(c.y-p);v<s.precision&&u<s.precision&&a(),i({x:h,y:p})})});return()=>{a(),n.kill()}}},E={passive:!1,multiplier:1,multiplierFirefox:25},w=(i={})=>{const s=Object.assign(E,i);return r=>{const n=s.target||document.documentElement;return t.Browser.wheelEvent?o.listenEl(n,"wheel",o=>{const n={x:0,y:0};i.passive||o.preventDefault(),n.x=o.wheelDeltaX||-1*o.deltaX,n.y=o.wheelDeltaY||-1*o.deltaY,n.x*=s.multiplier,n.y*=s.multiplier,t.Browser.firefox&&1===o.deltaMode&&(n.x*=s.multiplierFirefox,n.y*=s.multiplierFirefox),r.emit(e.ScrollerEvent.DELTA,n)},{passive:s.passive}):void 0}},x=(t={})=>o=>o.on(e.ScrollerEvent.SCROLL_TO,s=>{let r;s.skipOutputTransform&&(r=o.muteEvents(e.ScrollerEvent.TRANSFORM_OUTPUT));const n=o.position.virtual;if(t.nativeTarget){const e={};"number"==typeof s.pos.x&&(e.left=s.pos.x),"number"==typeof s.pos.y&&(e.top=s.pos.y),t.nativeTarget.scrollTo(Object.assign({behavior:t.nativeBehavior||"smooth"},e))}else{const e={};"number"==typeof s.pos.x&&(e.x=-(s.pos.x-n.x)),"number"==typeof s.pos.y&&(e.y=-(s.pos.y-n.y)),o.updateDelta(e)}i.Ticker.requestAnimationFrame(()=>{r&&r()})}),f={defaults:{width:"100%",height:"100%",overflow:"hidden"}},g=(e={})=>{const o=t.objectDeepMerge(f,e);return e=>{const t=e.dom.container.element;for(const e in o.defaults)o.defaults.hasOwnProperty(e)&&(t.style[e]=o.defaults[e]);return()=>{for(const e in o.defaults)o.defaults.hasOwnProperty(e)&&(t.style[e]="")}}},b={passive:!1,deltaMultiplier:1,velocityDamping:.08,velocityMultiplier:20,minimumThreshold:2},S=(s={})=>{const r=Object.assign(b,s);return s=>{const n=document.documentElement,l=r.target||n,a=new i.Ticker,c={x:0,y:0},h={x:0,y:0},p=r.minimumThreshold;let v=0,u=!1;const m=e=>e.targetTouches?e.targetTouches[0]:e;return o.listenCompose(o.listenEl(l,"touchstart",e=>{a.kill();const t=m(e);c.x=t.pageX,c.y=t.pageY,u=!0},{passive:r.passive}),o.listenEl(n,"touchend",()=>{u&&(0===h.x&&0===h.y||a.add((o,i,n)=>{h.x=t.lerp(h.x,0,r.velocityDamping),h.y=t.lerp(h.y,0,r.velocityDamping),s.emit(e.ScrollerEvent.DELTA,h),t.between(h.x,p,-p)&&t.between(h.y,p,-p)&&(h.x=0,h.y=0,n())})),u=!1},{passive:r.passive}),o.listenEl(n,"touchmove",t=>{if(u){t.preventDefault();const o={x:0,y:0},n=m(t);o.x=(n.pageX-c.x)*r.deltaMultiplier,o.y=(n.pageY-c.y)*r.deltaMultiplier;const l=i.Ticker.now()-v;h.x=(c.x-n.pageX)/l,h.y=(c.y-n.pageY)/l,h.x*=-1*r.velocityMultiplier,h.y*=-1*r.velocityMultiplier,c.x=n.pageX,c.y=n.pageY,v=i.Ticker.now(),s.emit(e.ScrollerEvent.DELTA,o)}},{passive:r.passive}))}},O={firefoxFix:!0,initialStyles:!0,precision:2},A=(e,t=0,o=0,i=!1)=>{let s=`translate3d(${-t}px, ${-o}px, 0)`;i&&(s+=" rotate3d(0.01, 0.01, 0.01, 0.01deg)"),e.style.transform=s},D=(o={})=>{const i=Object.assign(O,o),s=i.firefoxFix&&t.Browser.firefox;return o=>{const r=o.dom.wrapper.element,n=o.on(e.ScrollerEvent.OUTPUT,e=>{const o=t.cutDec(e.x,i.precision),n=t.cutDec(e.y,i.precision);A(r,o,n,s)});return i.initialStyles&&A(r,0,0,s),()=>{r.style.transform="",n()}}},L=(t={})=>i=>{let s;return i.on(e.ScrollerEvent.TWEEN_TO,({pos:n,options:l})=>{const a=!!l.force,c=o.listenCompose(void 0===t.nativeTarget?o.listenCompose(i.on(e.ScrollerEvent.DELTA,()=>{s&&!a&&s.stop()}),i.muteEvents(e.ScrollerEvent.TRANSFORM_OUTPUT,a&&e.ScrollerEvent.DELTA)):o.listenEl(t.nativeTarget,t.nativeKillEvents||["wheel","touchmove"],()=>{s&&!a&&s.stop()}));s&&s.stop(),s=r.Tween.fromTo(i.position.virtual,n,{mutate:!1,duration:l.duration,easing:l.easing,on:{update:e=>{t.nativeTarget?t.nativeTarget.scrollTo(e.x,e.y):i.updateDelta({x:i.position.virtual.x-e.x,y:i.position.virtual.y-e.y})},stop:()=>{c(),s=void 0},complete:()=>{c(),s=void 0}}})})},R={target:t.Browser.client?window:void 0},k=(t={})=>{const i=Object.assign(R,t);return t=>{const s=document.createElement("div"),r=t.dom.container.element.parentElement,n=()=>{s.style.height=`${t.dom.wrapper.size.height}px`};return n(),r&&r.append(s),o.listenCompose(()=>s.remove(),i.target?o.listenEl(i.target,"scroll",()=>t.emit(e.ScrollerEvent.DELTA,{x:t.position.virtual.x-window.scrollX,y:t.position.virtual.y-window.scrollY})):void 0,t.on(e.ScrollerEvent.RECALC,n))}};e.Scroller=a,e.ScrollerDom=n,e.bypassFocus=c,e.bypassNative=v,e.clampContent=u,e.keyboard=d,e.lerpContent=T,e.mouseWheel=w,e.nativeScrollbar=k,e.nativeSmoothScroll=((e,o={})=>new a(e,Object.assign({clampContent:u(),nativeScrollbar:k(o.scrollbar),lerpContent:T(o.lerp),bypassNative:v(Object.assign({condition:()=>t.Browser.mobile},o.native)),translate:D(o.translate),tweenTo:L(Object.assign({nativeTarget:t.Browser.client?window:void 0},o.tweenTo)),scrollTo:x(Object.assign({nativeTarget:t.Browser.client?window:void 0},o.scrollTo)),bypassFocus:c(Object.assign({nativeTarget:t.Browser.client?window:void 0},o.focus)),styleContainer:g({defaults:Object.assign({position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"},o.styles)})},o.behaviors||{}))),e.scrollTo=x,e.smoothScroll=((e,t={})=>new a(e,Object.assign({clampContent:u(),tweenTo:L(),scrollTo:x(),bypassFocus:c(t.focus),styleContainer:g({defaults:t.styles}),touchInertia:S(t.touch),lerpContent:T(t.lerp),mouseWheel:w(t.mouse),translate:D(t.translate),keyboard:d(t.keyboard)},t.behaviors||{}))),e.styleContainer=g,e.touchInertia=S,e.translate=D,e.tweenTo=L,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
