import{isNum as t,Browser as e,clamp as i,lerp as o,objectDeepMerge as s,between as a,cutDec as n}from"@smoovy/utils";import{EventEmitter as r,listenCompose as l,listenEl as c}from"@smoovy/event";import{Ticker as h}from"@smoovy/ticker";import{ElementObserver as p,ElementState as u}from"@smoovy/observer";import{Tween as d}from"@smoovy/tween";var m,v;!function(t){t.RECALC="recalc"}(m||(m={}));class y extends r{constructor(t){super(),this.config=t,this.dynamic=!1,this.dynamic=t.element instanceof HTMLElement,!1!==t.observer&&(this.observer=new p(t.observer)),this.container=new u(this.dynamic?document.createElement("div"):t.element.container),this.wrapper=new u(this.dynamic?document.createElement("div"):t.element.wrapper),this.observer&&(this.container=this.observer.observe(this.container),this.wrapper=this.observer.observe(this.wrapper),this.wrapper.changed(()=>this.emit(m.RECALC)),this.container.changed(()=>this.emit(m.RECALC))),this.dynamic&&(this.container.element.className+="smoovy-container",this.wrapper.element.className+="smoovy-wrapper",this.container.element.appendChild(this.wrapper.element))}recalc(t=!1){this.wrapper.update(t),this.container.update(t)}attach(){if(this.dynamic){const t=this.config.element,e=Array.from(t.childNodes);t.appendChild(this.container.element),this.wrapper.element.append(...e)}}detach(){if(this.dynamic){const t=this.config.element,e=Array.from(this.wrapper.element.childNodes);t.append(...e),t.removeChild(this.container.element)}}}!function(t){t.DELTA="delta",t.OUTPUT="output",t.VIRTUAL="virtual",t.RECALC="recalc",t.TWEEN_TO="tween_to",t.SCROLL_TO="scroll_to",t.TRANSFORM_DELTA="~delta",t.TRANSFORM_VIRTUAL="~virtual",t.TRANSFORM_OUTPUT="~output"}(v||(v={}));class T extends r{constructor(t,e){super(),this.attached=!1,this.locks=[],this.availableBehaviors=new Map,this.attachedBehaviors=new Map,this.position={output:{x:0,y:0},virtual:{x:0,y:0}},this.dom=t instanceof y?t:new y(t instanceof HTMLElement?{element:t}:t);for(const t in e)e.hasOwnProperty(t)&&this.setBehavior(t,e[t]);this.attach()}attach(){this.attached||(this.attached=!0,this.unlisten=l(this.dom.on(m.RECALC,()=>{this.updateDelta({x:0,y:0}),h.requestAnimationFrame(()=>this.emit(v.RECALC))}),this.on(v.DELTA,t=>{this.isLocked()||this.updateDelta(t)})),this.dom.attach(),this.availableBehaviors.forEach((t,e)=>{this.attachBehavior(e)}))}destroy(){this.attached&&(this.attached=!1,"function"==typeof this.unlisten&&(this.unlisten(),delete this.unlisten),this.dom.detach(),this.attachedBehaviors.forEach(t=>{"function"==typeof t&&t.call(this)}))}recalc(t=!1){this.dom.recalc(t),t?h.requestAnimationFrame(()=>this.emit(v.RECALC)):this.emit(v.RECALC)}get behaviors(){return this.availableBehaviors}setBehavior(t,e){this.availableBehaviors.set(t,e)}deleteBehavior(t){return this.attachedBehaviors.has(t)&&this.detachBehavior(t),this.availableBehaviors.delete(t)}attachBehavior(t){const e=this.availableBehaviors.get(t);return!(!e||this.attachedBehaviors.get(t)||(this.attachedBehaviors.set(t,e(this)),0))}detachBehavior(t){const e=this.attachedBehaviors.get(t);return!!e&&(e.call(this),this.attachedBehaviors.delete(t),!0)}updateDelta(e){const i=this.position.virtual;this.emit(v.TRANSFORM_DELTA,e,t=>{e.x=t.x,e.y=t.y}),this.updatePosition({x:t(e.x)?i.x-e.x:void 0,y:t(e.y)?i.y-e.y:void 0})}updatePosition(e){e&&t(e.x)&&(this.position.virtual.x=e.x),e&&t(e.y)&&(this.position.virtual.y=e.y),this.emit(v.VIRTUAL,this.position.virtual),this.emit(v.TRANSFORM_VIRTUAL,this.position.virtual,t=>{this.position.virtual.x=t.x,this.position.virtual.y=t.y}),this.isEventMuted(v.TRANSFORM_OUTPUT)||!this.hasEventListeners(v.TRANSFORM_OUTPUT)?this.updateOutput(this.position.virtual):this.emit(v.TRANSFORM_OUTPUT,{pos:this.position.output,step:t=>this.updateOutput(t)})}updateOutput(t){this.position.output.x=t.x,this.position.output.y=t.y,this.emit(v.OUTPUT,t)}lock(t="default",e=!0){!this.locks.includes(t)&&e?this.locks.push(t):e||this.unlock(t)}unlock(t="default"){const e=this.locks.indexOf(t);e>-1&&this.locks.splice(e,1)}isLocked(t){return t?this.locks.includes(t):this.locks.length>0}scrollTo(t,e=!1){this.emit(v.SCROLL_TO,{pos:t,skipOutputTransform:e})}tweenTo(t,e={}){this.emit(v.TWEEN_TO,{pos:t,options:e})}onVirtual(t){return this.on(v.VIRTUAL,t)}onScroll(t){return this.on(v.OUTPUT,t)}onDelta(t){return this.on(v.DELTA,t)}}const x=(t={})=>i=>{const o=t.focusTarget||e.client?window:void 0,s=i.dom.container.element,a=t.ignoreInside||[];return l(c(s,"scroll",t=>{t.preventDefault(),s.scrollLeft=s.scrollTop=0}),o?c(o,"focus",e=>{h.requestAnimationFrame(()=>{const o=e.target;if(o instanceof HTMLElement&&(!a.map(t=>t.contains(o)).includes(!0)&&o&&s.contains(o)||s===o)){const e=o.getBoundingClientRect(),s=i.dom.container.size;if(e.top<=0||e.top>=s.height||e.left<=0||e.right>=s.width)if(t.nativeTarget){const o=i.position.virtual;t.nativeTarget.scrollTo(o.x+e.left-s.width/2,o.y+e.top-s.height/2)}else i.emit(v.DELTA,{y:-e.top+s.height/2,x:-e.left+s.width/2})}})},!0):void 0)};function w(t,e=100,i=250,o=200,s=1/0){const a={x:0,y:0};switch(t.key){case" ":a.y=-o;break;case"ArrowLeft":a.x=e;break;case"ArrowRight":a.x=-e;break;case"ArrowDown":a.y=-e;break;case"ArrowUp":a.y=e;break;case"PageDown":a.y=-i;break;case"PageUp":a.y=i;break;case"Home":a.y=s;break;case"End":a.y=-s}return a}const f={condition:()=>!1},g=(e={})=>{const i=Object.assign(f,e);let o;return o=(e=>{const s=i.target||window,a=[];let n;const r=()=>({x:s===window?s.scrollX:s.scrollLeft,y:s===window?s.scrollY:s.scrollTop}),p=()=>{i.condition()?(e.behaviors.forEach((t,i)=>{t!==o&&(e.detachBehavior(i),a.push(i))}),n=l(c(s,"scroll",()=>{const t=r();e.emit(v.DELTA,{x:e.position.virtual.x-t.x,y:e.position.virtual.y-t.y})}),e.on(v.SCROLL_TO,({pos:e})=>{if(t(e.x)||t(e.y)){const i=r();s.scrollTo(t(e.x)?e.x:i.x,t(e.y)?e.y:i.y)}})),e.on(v.TWEEN_TO,({pos:t,options:i})=>{const o=!!i.force;let s;const a=()=>{s&&!o&&(s.stop(),s=void 0)},n=l(c(window,"touchstart",a),c(window,"wheel",a),c(window,"keydown",t=>{const e=w(t);"Tab"!==t.key&&0===e.x&&0===e.y||a()}));s=d.fromTo(e.position.virtual,t,{mutate:!1,duration:i.duration,easing:i.easing,on:{update:t=>window.scrollTo(t.x,t.y),complete:n,stop:n}})})):a.length>0&&(n&&(n(),n=void 0),a.forEach(t=>e.attachBehavior(t)),h.requestAnimationFrame(()=>e.dom.recalc()))};setTimeout(()=>p()),e.on(v.RECALC,()=>p())})},b=()=>t=>t.on(v.TRANSFORM_VIRTUAL,e=>{const o=t.dom.wrapper.size,s=t.dom.container.size,a=Math.max(o.width-s.width,0),n=Math.max(o.height-s.height,0);return{x:i(e.x,0,a),y:i(e.y,0,n)}}),O={passive:!1,target:e.client?document.documentElement:void 0,eventName:"keydown",arrowDelta:100,pageDelta:250,spaceDelta:200,homeEndDelta:1/0},E=(t={})=>{const i=Object.assign(O,t);return o=>{const s=i.target;return e.wheelEvent?c(s,i.eventName,t=>{const e=w(t,i.arrowDelta,i.pageDelta,i.spaceDelta,i.homeEndDelta);(e.x||e.y)&&o.emit(v.DELTA,e)},{passive:t.passive}):void 0}},A={damping:.1,precision:.009,mobileDamping:.18},L=(t={})=>{const i=Object.assign(A,t);return t=>{let s;const a=i.ticker||new h,n=e.mobile?i.mobileDamping:i.damping,r=t.on(v.TRANSFORM_OUTPUT,({pos:e,step:r})=>{s&&s.kill(),s=a.add((s,a,l)=>{const c=t.position.virtual,h=o(e.x,c.x,n),p=o(e.y,c.y,n),u=Math.abs(c.x-h),d=Math.abs(c.y-p);u<i.precision&&d<i.precision&&l(),r({x:h,y:p})})});return()=>{r(),a.kill()}}},R={passive:!1,multiplier:1,multiplierFirefox:25},D=(t={})=>{const i=Object.assign(R,t);return o=>{const s=i.target||document.documentElement;return e.wheelEvent?c(s,"wheel",s=>{const a={x:0,y:0};t.passive||s.preventDefault(),a.x=s.wheelDeltaX||-1*s.deltaX,a.y=s.wheelDeltaY||-1*s.deltaY,a.x*=i.multiplier,a.y*=i.multiplier,e.firefox&&1===s.deltaMode&&(a.x*=i.multiplierFirefox,a.y*=i.multiplierFirefox),o.emit(v.DELTA,a)},{passive:i.passive}):void 0}},C=(t={})=>e=>e.on(v.SCROLL_TO,i=>{let o;i.skipOutputTransform&&(o=e.muteEvents(v.TRANSFORM_OUTPUT));const s=e.position.virtual;if(t.nativeTarget){const e={};"number"==typeof i.pos.x&&(e.left=i.pos.x),"number"==typeof i.pos.y&&(e.top=i.pos.y),t.nativeTarget.scrollTo(Object.assign({behavior:t.nativeBehavior||"smooth"},e))}else{const t={};"number"==typeof i.pos.x&&(t.x=-(i.pos.x-s.x)),"number"==typeof i.pos.y&&(t.y=-(i.pos.y-s.y)),e.updateDelta(t)}h.requestAnimationFrame(()=>{o&&o()})}),k={defaults:{width:"100%",height:"100%",overflow:"hidden"}},U=(t={})=>{const e=s(k,t);return t=>{const i=t.dom.container.element;for(const t in e.defaults)e.defaults.hasOwnProperty(t)&&(i.style[t]=e.defaults[t]);return()=>{for(const t in e.defaults)e.defaults.hasOwnProperty(t)&&(i.style[t]="")}}},M={passive:!1,deltaMultiplier:1,velocityDamping:.08,velocityMultiplier:20,minimumThreshold:2},F=(t={})=>{const e=Object.assign(M,t);return t=>{const i=document.documentElement,s=e.target||i,n=new h,r={x:0,y:0},p={x:0,y:0},u=e.minimumThreshold;let d=0,m=!1;const y=t=>t.targetTouches?t.targetTouches[0]:t;return l(c(s,"touchstart",t=>{n.kill();const e=y(t);r.x=e.pageX,r.y=e.pageY,m=!0},{passive:e.passive}),c(i,"touchend",()=>{m&&(0===p.x&&0===p.y||n.add((i,s,n)=>{p.x=o(p.x,0,e.velocityDamping),p.y=o(p.y,0,e.velocityDamping),t.emit(v.DELTA,p),a(p.x,u,-u)&&a(p.y,u,-u)&&(p.x=0,p.y=0,n())})),m=!1},{passive:e.passive}),c(i,"touchmove",i=>{if(m){i.preventDefault();const o={x:0,y:0},s=y(i);o.x=(s.pageX-r.x)*e.deltaMultiplier,o.y=(s.pageY-r.y)*e.deltaMultiplier;const a=h.now()-d;p.x=(r.x-s.pageX)/a,p.y=(r.y-s.pageY)/a,p.x*=-1*e.velocityMultiplier,p.y*=-1*e.velocityMultiplier,r.x=s.pageX,r.y=s.pageY,d=h.now(),t.emit(v.DELTA,o)}},{passive:e.passive}))}},B={firefoxFix:!0,initialStyles:!0,precision:2},N=(t,e=0,i=0,o=!1)=>{let s=`translate3d(${-e}px, ${-i}px, 0)`;o&&(s+=" rotate3d(0.01, 0.01, 0.01, 0.01deg)"),t.style.transform=s},_=(t={})=>{const i=Object.assign(B,t),o=i.firefoxFix&&e.firefox;return t=>{const e=t.dom.wrapper.element,s=t.on(v.OUTPUT,t=>{const s=n(t.x,i.precision),a=n(t.y,i.precision);N(e,s,a,o)});return i.initialStyles&&N(e,0,0,o),()=>{e.style.transform="",s()}}},S=(t={})=>e=>{let i;return e.on(v.TWEEN_TO,({pos:o,options:s})=>{const a=!!s.force,n=l(void 0===t.nativeTarget?l(e.on(v.DELTA,()=>{i&&!a&&i.stop()}),e.muteEvents(v.TRANSFORM_OUTPUT,a&&v.DELTA)):c(t.nativeTarget,t.nativeKillEvents||["wheel","touchmove"],()=>{i&&!a&&i.stop()}));i&&i.stop(),i=d.fromTo(e.position.virtual,o,{mutate:!1,duration:s.duration,easing:s.easing,on:{update:i=>{t.nativeTarget?t.nativeTarget.scrollTo(i.x,i.y):e.updateDelta({x:e.position.virtual.x-i.x,y:e.position.virtual.y-i.y})},stop:()=>{n(),i=void 0},complete:()=>{n(),i=void 0}}})})},P={target:e.client?window:void 0},j=(t={})=>{const e=Object.assign(P,t);return t=>{const i=document.createElement("div"),o=t.dom.container.element.parentElement,s=()=>{i.style.height=`${t.dom.wrapper.size.height}px`};return s(),o&&o.append(i),l(()=>i.remove(),e.target?c(e.target,"scroll",()=>t.emit(v.DELTA,{x:t.position.virtual.x-window.scrollX,y:t.position.virtual.y-window.scrollY})):void 0,t.on(v.RECALC,s))}},I=(t,e={})=>new T(t,Object.assign({clampContent:b(),tweenTo:S(),scrollTo:C(),bypassFocus:x(e.focus),styleContainer:U({defaults:e.styles}),touchInertia:F(e.touch),lerpContent:L(e.lerp),mouseWheel:D(e.mouse),translate:_(e.translate),keyboard:E(e.keyboard)},e.behaviors||{})),X=(t,i={})=>new T(t,Object.assign({clampContent:b(),nativeScrollbar:j(i.scrollbar),lerpContent:L(i.lerp),bypassNative:g(Object.assign({condition:()=>e.mobile},i.native)),translate:_(i.translate),tweenTo:S(Object.assign({nativeTarget:e.client?window:void 0},i.tweenTo)),scrollTo:C(Object.assign({nativeTarget:e.client?window:void 0},i.scrollTo)),bypassFocus:x(Object.assign({nativeTarget:e.client?window:void 0},i.focus)),styleContainer:U({defaults:Object.assign({position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%"},i.styles)})},i.behaviors||{}));export{T as Scroller,y as ScrollerDom,m as ScrollerDomEvent,v as ScrollerEvent,x as bypassFocus,g as bypassNative,b as clampContent,E as keyboard,L as lerpContent,D as mouseWheel,j as nativeScrollbar,X as nativeSmoothScroll,C as scrollTo,I as smoothScroll,U as styleContainer,F as touchInertia,_ as translate,S as tweenTo};
//# sourceMappingURL=index.esm.js.map
